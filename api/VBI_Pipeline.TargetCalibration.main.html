
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>main &#8212; VBI_Pipeline v0.10.0</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700" type="text/css" />
    <link rel="stylesheet" href="../_static/dkist.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favico.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="make_binary_gauss" href="VBI_Pipeline.TargetCalibration.make_binary_gauss.html" />
    <link rel="prev" title="load_hough_pickle" href="VBI_Pipeline.TargetCalibration.load_hough_pickle.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="col-md-3 navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://nso.edu"><img src="../_static/img/NSOlogo.gif">
        </a>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav hidden">
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">VBI Pipeline Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../walkthrough.html">Data Reduction Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config_file.html">Configuration File Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../IPA_access.html">Instrument Partner Testing Access</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../API.html">Reference/API</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">main</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="VBI_Pipeline.TargetCalibration.load_hough_pickle.html" title="Previous Chapter: load_hough_pickle"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; load_hough_pickle</span>
    </a>
  </li>
  <li>
    <a href="VBI_Pipeline.TargetCalibration.make_binary_gauss.html" title="Next Chapter: make_binary_gauss"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">make_binary_gauss &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>
          
            <ul class="nav navbar-nav navbar-left">
              <li><a href="http://dkist.nso.edu/">DKIST</a></li>
              <li><a href="http://docs.cadair.com/devdocs">DC Developer Guide</a></li>
              <li><a href="http://docs.cadair.com/datarate">DKIST Data Rate</a></li>
              <li><a href="http://docs.cadair.com/datamodel">DKIST Data Model</a></li>
            </ul>
          
          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">

    <div class="col-md-3"><div id="side-logo" >
            <a href="http://dkist.nso.edu">
                <img src="../_static/img/DKISTLogo-Medium.jpg">
            </a>
        </div><div id="sidebar" class="bs-sidenav" role="complementary">
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">VBI Pipeline Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../walkthrough.html">Data Reduction Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config_file.html">Configuration File Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../IPA_access.html">Instrument Partner Testing Access</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../API.html">Reference/API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../API.html#module-VBI_Pipeline.VBIPipeline">VBI_Pipeline.VBIPipeline Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API.html#module-VBI_Pipeline.VBIStitch">VBI_Pipeline.VBIStitch Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API.html#module-VBI_Pipeline.DarkCalibration">VBI_Pipeline.DarkCalibration Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API.html#module-VBI_Pipeline.GainCalibration">VBI_Pipeline.GainCalibration Module</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../API.html#module-VBI_Pipeline.TargetCalibration">VBI_Pipeline.TargetCalibration Module</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../API.html#id6">Functions</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="VBI_Pipeline.TargetCalibration.analyze_hough.html">analyze_hough</a></li>
<li class="toctree-l4"><a class="reference internal" href="VBI_Pipeline.TargetCalibration.check_shifts.html">check_shifts</a></li>
<li class="toctree-l4"><a class="reference internal" href="VBI_Pipeline.TargetCalibration.collect_intersections.html">collect_intersections</a></li>
<li class="toctree-l4"><a class="reference internal" href="VBI_Pipeline.TargetCalibration.command_line.html">command_line</a></li>
<li class="toctree-l4"><a class="reference internal" href="VBI_Pipeline.TargetCalibration.find_intersections.html">find_intersections</a></li>
<li class="toctree-l4"><a class="reference internal" href="VBI_Pipeline.TargetCalibration.find_match_idx.html">find_match_idx</a></li>
<li class="toctree-l4"><a class="reference internal" href="VBI_Pipeline.TargetCalibration.fwhm.html">fwhm</a></li>
<li class="toctree-l4"><a class="reference internal" href="VBI_Pipeline.TargetCalibration.gen_debug_plots.html">gen_debug_plots</a></li>
<li class="toctree-l4"><a class="reference internal" href="VBI_Pipeline.TargetCalibration.generate_target_calibration.html">generate_target_calibration</a></li>
<li class="toctree-l4"><a class="reference internal" href="VBI_Pipeline.TargetCalibration.load_hough_pickle.html">load_hough_pickle</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">main</a></li>
<li class="toctree-l4"><a class="reference internal" href="VBI_Pipeline.TargetCalibration.make_binary_gauss.html">make_binary_gauss</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../API.html#module-VBI_Pipeline.Data">VBI_Pipeline.Data Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API.html#module-VBI_Pipeline.generic">VBI_Pipeline.generic Module</a></li>
</ul>
</li>
</ul>

            
        </div>
    </div>

    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="main">
<h1>main<a class="headerlink" href="#main" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="VBI_Pipeline.TargetCalibration.main">
<code class="sig-prename descclassname">VBI_Pipeline.TargetCalibration.</code><code class="sig-name descname">main</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">grid_dir</span></em>, <em class="sig-param"><span class="n">outname</span></em>, <em class="sig-param"><span class="n">suffix</span><span class="o">=</span><span class="default_value">'FITS'</span></em>, <em class="sig-param"><span class="n">dark_cal</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">gain_cal</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">gauss_sigma</span><span class="o">=</span><span class="default_value">30.0</span></em>, <em class="sig-param"><span class="n">dmax</span><span class="o">=</span><span class="default_value">15.0</span></em>, <em class="sig-param"><span class="n">rho_min_dist</span><span class="o">=</span><span class="default_value">100</span></em>, <em class="sig-param"><span class="n">refidx</span><span class="o">=</span><span class="default_value">4</span></em>, <em class="sig-param"><span class="n">rho_smooth</span><span class="o">=</span><span class="default_value">10.0</span></em>, <em class="sig-param"><span class="n">binary_threshold</span><span class="o">=</span><span class="default_value">0.1</span></em>, <em class="sig-param"><span class="n">sigclip</span><span class="o">=</span><span class="default_value">3.0</span></em>, <em class="sig-param"><span class="n">peak_threshold</span><span class="o">=</span><span class="default_value">0.1</span></em>, <em class="sig-param"><span class="n">theta_window</span><span class="o">=</span><span class="default_value">0.008726646259971648</span></em>, <em class="sig-param"><span class="n">bimode_choice</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">debug</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/VBI_Pipeline/TargetCalibration.html#main"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#VBI_Pipeline.TargetCalibration.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute a TargetCalibration (i.e., wcs sub-pixel offsets) given an input linegrid image.</p>
<p>Pre-processing by dark and gain Calibration products can be induced by specifying the corresponding FitsData
objects. The gain calibration, in particular, is extremely necessary for good analysis.</p>
<p>The 4 special parameters exposed here (gauss_sigma, dmax, rho_min_dist, and refidx) vary greatly whether considering
Blue or Red camera data. Watch out!</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>grid_dir</strong><span class="classifier">str</span></dt><dd><p>Location of directory containing the linegrid data</p>
</dd>
<dt><strong>outname</strong><span class="classifier">str</span></dt><dd><p>The path of the resulting Target Calibration Data.FitsData file</p>
</dd>
<dt><strong>dark_cal</strong><span class="classifier">Data.FitsData</span></dt><dd><p>A Dark Calibration object</p>
</dd>
<dt><strong>gain_cal</strong><span class="classifier">Data.FitsData</span></dt><dd><p>A Gain Calibration object</p>
</dd>
<dt><strong>gauss_sigma</strong><span class="classifier">float</span></dt><dd><p>Width of smoothing kernel used to construct a binary image from the input data. Should be slightly less than
the pixel width of the grid lines.</p>
</dd>
<dt><strong>dmax</strong><span class="classifier">float</span></dt><dd><p>Any intersections with pixel locations less than dmax apart are considered to be the same intersection.</p>
</dd>
<dt><strong>rho_min_dist</strong><span class="classifier">float</span></dt><dd><p>Minimum distance (in Hough space coordinates) allowed between peaks in rho. This parameter is highly dependent
on the pixel scale of the grid lines.</p>
</dd>
<dt><strong>refidx</strong><span class="classifier">int</span></dt><dd><p>Index of the reference hdu to use. Index corresponds to the location in both intsects and pos_list</p>
</dd>
<dt><strong>rho_smooth</strong><span class="classifier">float</span></dt><dd><p>Sigma of smoothing kernel used to remove noise from the rho rss. Something b/t 5 and 10 is probably good.</p>
</dd>
<dt><strong>binary_threshold</strong><span class="classifier">float</span></dt><dd><p>Min percentage of pixels to be on one side of the Otsu threshold when constructing the binary image.
If the percentage of pixels above the threshold is outside the range (binary_threshold, 1 - binary_threshold),
then some cleaning of outlying pixels is performed.</p>
</dd>
<dt><strong>sigclip</strong><span class="classifier">float</span></dt><dd><p>Any pixels beyond sigclip standard deviations from the mean are excluded from the binary thresholding
calculation.</p>
</dd>
<dt><strong>bimode_choice</strong><span class="classifier">list</span></dt><dd><p>List containing the automatic choice for potential bimodality in the (x, y) dimensions. Choice can be either
1 or 2; 1 always corresponds to the mode closest to the global median.</p>
</dd>
<dt><strong>suffix</strong><span class="classifier">str</span></dt><dd><p>Only load files with this suffix</p>
</dd>
<dt><strong>peak_threshold</strong><span class="classifier">float</span></dt><dd><p>Relative cutoff for detecting peaks in the Hough transform [0 - 1]. Larger numbers will exclude shorter lines,
but can help if spurious lines are being detected.</p>
</dd>
<dt><strong>theta_window</strong><span class="classifier">float</span></dt><dd><p>Size of region (in radians) around the peak angles to include when looking for peaks in the Hough rho dimension.
Smaller numbers can improve the centering of rho peaks</p>
</dd>
<dt><strong>debug</strong><span class="classifier">bool</span></dt><dd><p>If True the code will stop at each hdu (i.e., camera position) and generate some diagnostic plots that show the
computed lines and grid intersections.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>Data.FitsData</dt><dd><p>A Target Calibration.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <div class="left-footer">
         &copy; 2020, Arthur Eigenbrot
       <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a>
    </div>
   
    <div class="right-footer">
      Last updated on 30 Sep 2020.
    </div>
    <div class="centre-footer">
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1
    </div>
  </div>
</footer>
  </body>
</html>