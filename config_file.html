
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Configuration File Format &#8212; VBI_Pipeline v0.8.2</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700" type="text/css" />
    <link rel="stylesheet" href="_static/dkist.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="shortcut icon" href="_static/favico.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Instrument Partner Testing Access" href="IPA_access.html" />
    <link rel="prev" title="Data Reduction Walkthrough" href="walkthrough.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="col-md-3 navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://nso.edu"><img src="_static/img/NSOlogo.gif">
        </a>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav hidden">
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">VBI Pipeline Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="walkthrough.html">Data Reduction Walkthrough</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration File Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="IPA_access.html">Instrument Partner Testing Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">Reference/API</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Configuration File Format</a><ul>
<li><a class="reference internal" href="#main">Main</a></li>
<li><a class="reference internal" href="#darkcalibration">DarkCalibration</a></li>
<li><a class="reference internal" href="#gaincalibration">GainCalibration</a></li>
<li><a class="reference internal" href="#targetcalibration">TargetCalibration</a></li>
<li><a class="reference internal" href="#example-config-file">Example Config File</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="walkthrough.html" title="Previous Chapter: Data Reduction Walkthrough"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Data Reductio...</span>
    </a>
  </li>
  <li>
    <a href="IPA_access.html" title="Next Chapter: Instrument Partner Testing Access"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Instrument Pa... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>
          
            <ul class="nav navbar-nav navbar-left">
              <li><a href="http://dkist.nso.edu/">DKIST</a></li>
              <li><a href="http://docs.cadair.com/devdocs">DC Developer Guide</a></li>
              <li><a href="http://docs.cadair.com/datarate">DKIST Data Rate</a></li>
              <li><a href="http://docs.cadair.com/datamodel">DKIST Data Model</a></li>
            </ul>
          
          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">

    <div class="col-md-3"><div id="side-logo" >
            <a href="http://dkist.nso.edu">
                <img src="_static/img/DKISTLogo-Medium.jpg">
            </a>
        </div><div id="sidebar" class="bs-sidenav" role="complementary">
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">VBI Pipeline Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="walkthrough.html">Data Reduction Walkthrough</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration File Format</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main">Main</a></li>
<li class="toctree-l2"><a class="reference internal" href="#darkcalibration">DarkCalibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gaincalibration">GainCalibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#targetcalibration">TargetCalibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-config-file">Example Config File</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="IPA_access.html">Instrument Partner Testing Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">Reference/API</a></li>
</ul>

            
        </div>
    </div>

    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="configuration-file-format">
<h1>Configuration File Format<a class="headerlink" href="#configuration-file-format" title="Permalink to this headline">¶</a></h1>
<p>The VBI Pipeline configuration file is in the standard INI format and contains a subset of the sections and options
listed below. All options in <em>italics</em> are optional; if they are not provided by the user then default values will be
loaded.</p>
<div class="section" id="main">
<h2>Main<a class="headerlink" href="#main" title="Permalink to this headline">¶</a></h2>
<p>This section controls the top-level Science reduction. All of the <code class="docutils literal notranslate"><span class="pre">*_cal</span></code> options point to files that will not exist
on the first run of the pipeline. Once these objects have been created a lot of time can be saved by reusing them for
any other science runs that have the same setup. It is also possible to regenerate only a subset of the intermediate
Calibration Objects by simply pointing the corresponding option to a file that doesn’t exist.</p>
<dl class="field-list simple">
<dt class="field-odd">raw_sci_dir</dt>
<dd class="field-odd"><p>Path to a directory containing all of the Object (i.e., science) FITS files that will be reduced</p>
</dd>
<dt class="field-even">data_set_id</dt>
<dd class="field-even"><p>A string that is used to refine the selection of data from <code class="docutils literal notranslate"><span class="pre">raw_sci_dir</span></code>. Only files whose ‘ID_004’
metadata matches this parameter will be used. If left blank then all data in the <code class="docutils literal notranslate"><span class="pre">raw_sci_dir</span></code> will be treated as
a single data set, which might produce some strange looking outputs. <strong>Note</strong> As a special case, if this option is
“all” then each data set found in the directory will be reduced separately.</p>
</dd>
<dt class="field-odd">output</dt>
<dd class="field-odd"><p>Path to file in which to save the reduced output images. <strong>Note:</strong> In the cas where <code class="docutils literal notranslate"><span class="pre">data_set_id</span> <span class="pre">=</span> <span class="pre">all</span></code> this
option defines the prefix used when saving each separate data set. They will be saved as OUTPUT_ID004.fits.</p>
</dd>
<dt class="field-even">dark_cal</dt>
<dd class="field-even"><p>The location of the processed DarkCalibration object. If this file does not exist it will be generated.</p>
</dd>
<dt class="field-odd">gain_cal</dt>
<dd class="field-odd"><p>The location of the processed GainCalibration object. If this file does not exist it will be generated.</p>
</dd>
<dt class="field-even">target_cal</dt>
<dd class="field-even"><p>The location of the processed TargetCalibration object. If this file does not exist it will  be generated.</p>
</dd>
<dt class="field-odd">flush</dt>
<dd class="field-odd"><p>If ‘True’ then the VBI Pipeline will try to write intermediate data products and read them using memmap in an
attempt to save on memory usage. This results in a slight performance hit, but might be the only way you can get
a huge data set to process without running out of RAM.</p>
</dd>
</dl>
</div>
<div class="section" id="darkcalibration">
<h2>DarkCalibration<a class="headerlink" href="#darkcalibration" title="Permalink to this headline">¶</a></h2>
<p>This section is only relevant if the file referenced by <code class="docutils literal notranslate"><span class="pre">Main.dark_cal</span></code> does not exist.</p>
<dl class="field-list simple">
<dt class="field-odd">raw_dark_dir</dt>
<dd class="field-odd"><p>Path to a directory containing the dark frames to use during reduction. Can be the same as
<code class="docutils literal notranslate"><span class="pre">Main.raw_sci_dir</span></code>.</p>
</dd>
<dt class="field-even"><em>low_acceptance_threshold</em></dt>
<dd class="field-even"><p><strong>(float)</strong> This sets the lower limit for the fraction of outlying pixels that are allowed
in a good DarkCalibration object. If the fraction of pixels in the object that are less than 1 stddev away
from the mean is less than 0.682 - low_acceptance parameter an error will be thrown.</p>
</dd>
<dt class="field-odd"><em>high_acceptance_threshold</em></dt>
<dd class="field-odd"><p><strong>(float)</strong> This sets the lower limit for the fraction of outlying pixels that are allowed
in a good DarkCalibration object. If the fraction of pixels in the object that are less than 1 stddev away
from the mean is more than 0.682 + low_acceptance parameter an error will be thrown.</p>
</dd>
</dl>
</div>
<div class="section" id="gaincalibration">
<h2>GainCalibration<a class="headerlink" href="#gaincalibration" title="Permalink to this headline">¶</a></h2>
<p>This section is only relevant if the file referenced by <code class="docutils literal notranslate"><span class="pre">Main.gain_cal</span></code> does not exist.</p>
<dl class="field-list simple">
<dt class="field-odd">raw_gain_dir</dt>
<dd class="field-odd"><p>Path to a directory containing the gain frames to use during reduction. Can be the same as
<code class="docutils literal notranslate"><span class="pre">Main.raw_sci_dir</span></code>.</p>
</dd>
<dt class="field-even"><em>low_acceptance_threshold</em></dt>
<dd class="field-even"><p><strong>(float)</strong> This sets the lower limit for the fraction of outlying pixels that are allowed
in a good GainCalibration object. If the fraction of pixels in the object that are less than 1 stddev away
from the mean is less than 0.682 - low_acceptance parameter an error will be thrown.</p>
</dd>
<dt class="field-odd"><em>high_acceptance_threshold</em></dt>
<dd class="field-odd"><p><strong>(float)</strong> This sets the lower limit for the fraction of outlying pixels that are allowed
in a good GainCalibration object. If the fraction of pixels in the object that are less than 1 stddev away
from the mean is more than 0.682 + low_acceptance parameter an error will be thrown.</p>
</dd>
</dl>
</div>
<div class="section" id="targetcalibration">
<h2>TargetCalibration<a class="headerlink" href="#targetcalibration" title="Permalink to this headline">¶</a></h2>
<p>This section is only relevant if the file referenced by <code class="docutils literal notranslate"><span class="pre">Main.target_cal</span></code> does not exist.</p>
<dl class="field-list simple">
<dt class="field-odd">raw_grid_dir</dt>
<dd class="field-odd"><p>Path to a directory containing the observations of the GOS calibration grid. Can be the same as
<code class="docutils literal notranslate"><span class="pre">Main.raw_sci_dir</span></code>.</p>
</dd>
<dt class="field-even"><em>refidx</em></dt>
<dd class="field-even"><p><strong>(int)</strong> The camera position (0-indexed) to use as the reference position when computing the sub-pixel, WCS
shifts for all frames (i.e., TargetCalibration). Whatever position you choose should overlap with all other
positions.</p>
</dd>
<dt class="field-odd"><em>rho_smooth</em></dt>
<dd class="field-odd"><p><strong>(int)</strong> The smoothing kernel (in pixels) to use when smoothing rho vectors in the Hough Transform. More
smoothing can help with dirty detectors or GOS line grids, but too much might reduce the accuracy of the
TargetCalibration.</p>
</dd>
<dt class="field-even"><em>gauss_sigma</em></dt>
<dd class="field-even"><p><strong>(float)</strong> The smoothing kernel (in pixels) used to help identify grid lines. This number should be close
to the pixel width of the lines themselves.</p>
</dd>
<dt class="field-odd"><em>rho_min_dist</em></dt>
<dd class="field-odd"><p><strong>(float)</strong> The minimum separation (in pixels) allowed between lines identified by the Hough Transform.
Unfortunately, the ‘pixels’ referenced here do NOT necessarily correspond to pixels on the image.</p>
</dd>
<dt class="field-even"><em>dmax</em></dt>
<dd class="field-even"><p><strong>(float)</strong> The maximum radial distance (in pixels) between two grid intersections in different camera positions
where the intersections are called the same.</p>
</dd>
<dt class="field-odd"><em>binary_threshold</em></dt>
<dd class="field-odd"><p><strong>(float)</strong> This is used to clean up the binary grid image that is passed to the Hough Transform.
If the percentage of pixels above the binary threshold is outside the range (binary_threshold, 1 - binary_threshold)
then some cleaning of outlying pixels is performed.</p>
</dd>
<dt class="field-even"><em>sigclip</em></dt>
<dd class="field-even"><p><strong>(float)</strong> Another way to keep the binary image clean. Any pixels more than sigclip standard deviations away
from the image mean are ignored.</p>
</dd>
<dt class="field-odd"><em>bimode_choice</em></dt>
<dd class="field-odd"><p><strong>(list)</strong> You’ll hopefully never need this. Sometimes the camera offsets can be such that the distribution
of offsets between camera positions is bi-modal. If this option is not specified then the user is asked to manually select
which mode to use. For future runs you can specify a list of automatic choices so user input is not needed. The format
is a list of lists, one [x, y] list for each camera position. The [x, y] lists contain your choice of mode for the x and y
shift directions. The choice must be either 1 or 2; 1 always selects the mode closest to the global median and is almost always
the correct choice. Example (for VBI-RED, which has 4 camera positions): <code class="docutils literal notranslate"><span class="pre">[[1,1],</span> <span class="pre">[2,1],</span> <span class="pre">[1,1],</span> <span class="pre">[1,2]]</span></code>. <strong>NOTE:</strong>
You can also specify a single number to select the same option for all camera positions. For example, set it to <code class="docutils literal notranslate"><span class="pre">1</span></code> if
you just want to always choose the strongest mode and not be bothered. <strong>NOTE (pt2):</strong> There are some secret options:
if you select either -1 or -2 then the shift will be exactly the selected median and the algorithm will not be re-run.
If you select 0 then the global median is used and the algorithm is not re-run.</p>
</dd>
</dl>
</div>
<div class="section" id="example-config-file">
<h2>Example Config File<a class="headerlink" href="#example-config-file" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Main]</span>
<span class="na">raw_sci_dir</span> <span class="o">=</span> <span class="s">../</span>
<span class="na">data_set_id</span> <span class="o">=</span> <span class="s">GOS target</span>
<span class="na">output</span> <span class="o">=</span> <span class="s">SciTarget.fits</span>
<span class="na">dark_cal</span> <span class="o">=</span> <span class="s">DarkCal.fits</span>
<span class="na">gain_cal</span> <span class="o">=</span> <span class="s">GainCal.fits</span>
<span class="na">target_cal</span> <span class="o">=</span> <span class="s">TargetCal.fits</span>
<span class="na">flush</span> <span class="o">=</span> <span class="s">False</span>

<span class="k">[DarkCalibration]</span>
<span class="na">raw_dark_dir</span> <span class="o">=</span> <span class="s">../</span>

<span class="k">[GainCalibration]</span>
<span class="na">raw_gain_dir</span> <span class="o">=</span> <span class="s">../</span>

<span class="k">[TargetCalibration]</span>
<span class="na">raw_grid_dir</span> <span class="o">=</span> <span class="s">../</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <div class="left-footer">
         &copy; 2019, Arthur Eigenbrot
       <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a>
    </div>
   
    <div class="right-footer">
      Last updated on 19 Nov 2019.
    </div>
    <div class="centre-footer">
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1
    </div>
  </div>
</footer>
  </body>
</html>